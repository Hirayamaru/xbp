<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=yes, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="NOWをLIVEしろ！">
    <title>HIRAYAMARU_DOYOLAB </title>
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="stylesheet" type="text/css" media="all" href="./css/style.css">
    <script src="js/jquery1.4.4.min.js"></script>
    <script src="js/script.js"></script>
    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
    <script src="./js/overlay_anim.js"></script> 
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https://code.createjs.com;">
</head>

<body>

    <header id="header" role="banner">
        <div class="inner">
            <div class="logo">
                <a href="index.html" title="HIRAYAMARU_DOYOLAB" rel="home">doyolab<br /><span>Kiichi Hirayama</span></a>
                <h1>&nbsp;</h1>
            </div>
            <nav id="mainNav">
                <div class="inner">
                    <a class="menu" id="menu"><span>MENU</span></a>
                    <div class="panel">
                        <ul id="topnav">
                            <li class="current-menu-item"><a href="../doyolab/index.html"><strong>　HOME&nbsp;</strong><br /><span>&nbsp;</span></a></li>
                            <li><a href="../xbp/de12/de1.2.index.html"><strong></strong>KAMAKURA　PROJECT<br /><span>Group profect</span></a></li>
                            <li><a href="../xbp/digi_fab/dg.index.html"><strong>YOKOHAMA GREEN EXPO　&nbsp;</strong><br /><span>&nbsp;Group profect</span></a></li>
                            <li><a href="../xbp/de34/de3.4.index.html"><strong>DESIGN &nbsp;</strong><br /><span>POSTER　DESIGN&nbsp;</span></a></li>
                            <li><a href="../index.html"><strong>XBP</strong><br /><span>Project thats my first and second years</span></a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <div id="mainBanner">
        <div class="inner">
            <img src="../images/E4BD64C0-2B2C-4B0E-94C5-F6ED9C28D5B4_1_201_a 2.jpeg" width="4032" height="1457" alt="">
        </div>
    </div>

    <div id="wrapper">
        <section class="gridWrapper">
            <article class="grid">
                <div class="box">
                    <h3>KAMAKURA　PROJECT</h3>
                    <p class="img">
                        <a href="../xbp/de12/de1.2.index.html">
                            <img width="220" height="300" src="../images/fxn 2025-04-06 173524.655.jpeg" alt="" />
                        </a>
                    </p>
                    
                    <p class="readmore"><a href="../xbp/de12/de1.2.index.html"></a></p>
                </div>
            </article>  
            <article class="grid">
                <div class="box">
                    <h3>YOKOHAMA&nbsp; GREEN EXPO</h3>
                    <p class="img">
                        <a href="../xbp/digi_fab/dg.index.html">
                            <img width="220" height="300" src="../images/fxn 2025-03-25 064146.044.jpeg" alt="" />
                        </a>
                    </p>
                    
                    <p class="readmore"><a href="../xbp/digi_fab/dg.index.html"></a></p>
                </div>
            </article>  
            <article class="grid">
                <div class="box">
                    <h3>DESIGN&nbsp;</h3>
                    <p class="img">
                        <a href="../xbp/de34/de3.4.index.html">
                            <img width="220" height="300" src="../images/fxn 2025-03-25 071015.353.jpeg" alt="" />
                        </a>
                    </p>
                    
                    <p class="readmore"><a href="../xbp/de34/de3.4.index.html"></a></p>
                </div>
            </article>
            <article class="grid">
                <div class="box">
                    <h3>XBP<div class=""></div></h3>
                    <p class="img">
                        <a href="../index.html">
                            <img width="220" height="300" src="../images/fxn 2025-04-15 161513.472.jpeg" alt="" />
                        </a>
                    </p>
                    
                    <p class="readmore"><a href="../xbp/de56/de5.6.index.html"></a></p>
                </div>
            </article>
        </section>

        <div id="animation_container_custom" style="background-color:rgba(255, 255, 255, 0.00); position: absolute; top: 0; left: 0; pointer-events: none; overflow: hidden;">
            <canvas id="canvas_custom" style="display: block; background-color:rgba(255, 255, 255, 0.00);"></canvas>
            <div id="dom_overlay_container_custom" style="pointer-events:none; overflow:hidden; position: absolute; left: 0px; top: 0px; display: block;">
            </div>
        </div>
        </div> <script>
        // Animateが生成したinit関数をベースに調整し、変数名を既存のHTMLと重複しないように変更しています
        var canvas_custom, stage, exportRoot, anim_container_custom, dom_overlay_container_custom, fnStartAnimation;

        function initAnimate() { 
            // HTML要素のIDをカスタムIDで取得
            canvas_custom = document.getElementById("canvas_custom");
            anim_container_custom = document.getElementById("animation_container_custom");
            dom_overlay_container_custom = document.getElementById("dom_overlay_container_custom");
    
            // Animateから書き出されたJSのCompositionを取得
            // "E226CF9421B64910B01BF579E3526604" は overlay_anim.js 内の lib.properties.id と一致させる
            var comp=AdobeAn.getComposition("E226CF9421B64910B01BF579E3526604"); 
            var lib=comp.getLibrary();
            var loader = new createjs.LoadQueue(false); // ロードキューの作成
            loader.addEventListener("fileload", function(evt){handleFileLoad(evt,comp)});
            loader.addEventListener("complete", function(evt){handleComplete(evt,comp)});
            loader.loadManifest(lib.properties.manifest); // Animateのアセット（画像など）をロード
    
            // ロード中のファイル処理
            function handleFileLoad(evt, comp) {
                var images=comp.getImages();	
                if (evt && (evt.item.type == "image")) { images[evt.item.id] = evt.result; }	
            }
            
            // 全てのファイルロード完了後の処理
            function handleComplete(evt,comp) {
                var lib=comp.getLibrary();
                var ss=comp.getSpriteSheet();
                var queue = evt.target;
                var ssMetadata = lib.ssMetadata;
                for(i=0; i<ssMetadata.length; i++) {
                    // スプライトシートを初期化
                    ss[ssMetadata[i].name] = new createjs.SpriteSheet( {"images": [queue.getResult(ssMetadata[i].name)], "frames": ssMetadata[i].frames} )
                }
                // アニメーションのルートオブジェクトを生成
                exportRoot = new lib.HP_check(); // "HP_check"はoverlay_anim.js内のStage Contentの名前
                // Stageオブジェクトを生成し、canvasと紐付け
                stage = new lib.Stage(canvas_custom);	
                
                // アニメーション開始関数
                fnStartAnimation = function() {
                    stage.addChild(exportRoot); // ルートオブジェクトをステージに追加
                    createjs.Ticker.framerate = lib.properties.fps; // フレームレートを設定
                    createjs.Ticker.addEventListener("tick", stage); // 更新イベントリスナーを設定
                }	    
                
                AdobeAn.compositionLoaded(lib.properties.id);
                fnStartAnimation(); // アニメーションを開始
    
                // ウィンドウサイズ変更時にキャンバスを調整する処理を呼び出す
                resizeAnimateCanvas();
            }
        }
    
        // レスポンシブ調整関数
        function resizeAnimateCanvas() {
            const canvas = document.getElementById("canvas_custom");
            const anim_container = document.getElementById("animation_container_custom");
            const dom_overlay_container = document.getElementById("dom_overlay_container_custom");
    
            // Animateの元のステージサイズ (Animateで設定した幅と高さ)
            // ここはAnimateで「最終的に設定したステージ幅と高さ」に合わせてください。
            // 例えば、AnimateでW 940, H 350に設定した場合、以下のように入力します。
            const animateBaseWidth = 940; // ★あなたのAnimateステージの幅に修正★
            const animateBaseHeight = 350; // ★あなたのAnimateステージの高さに修正★
    
            // gridWrapper（画像が含まれるセクション）を基準に位置とサイズを決定
            const gridWrapper = document.querySelector(".gridWrapper");
            if (!gridWrapper) {
                console.warn("gridWrapperが見つかりません。キャンバスの配置に問題が生じる可能性があります。");
                return;
            }
    
            const currentWrapperWidth = gridWrapper.offsetWidth; // gridWrapperの現在の表示幅
            
            // Animateのステージの基準幅と現在のwrapper幅の比率
            let scale = currentWrapperWidth / animateBaseWidth;
            
            // 高DPIスクリーン対応 (Retinaなど)
            const pRatio = window.devicePixelRatio || 1;
    
            // canvas要素の width/height 属性をピクセル数で設定 (描画の解像度)
            canvas.width = animateBaseWidth * pRatio;
            canvas.height = animateBaseHeight * pRatio;
    
            // canvas要素の CSS width/height を設定 (表示サイズ)
            canvas.style.width = currentWrapperWidth + 'px'; // gridWrapperの幅に合わせる
            canvas.style.height = (animateBaseHeight * scale) + 'px'; // アスペクト比を維持して高さを計算
    
            // Animateのステージ全体のスケールを調整
            if (stage) {
                stage.scaleX = stage.scaleY = scale * pRatio;
                stage.update();
            }
    
            // dom_overlay_container のサイズも調整
            dom_overlay_container.style.width = currentWrapperWidth + 'px';
            dom_overlay_container.style.height = (animateBaseHeight * scale) + 'px';
    
            // anim_container を gridWrapper と同じ位置に配置
            // gridWrapperのページ全体からの位置を取得
            const wrapperRect = gridWrapper.getBoundingClientRect();
            // スクロール量を考慮してtopとleftを計算
            const bodyScrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            const bodyScrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft;
            
            anim_container.style.top = (wrapperRect.top + bodyScrollTop) + 'px';
            anim_container.style.left = (wrapperRect.left + bodyScrollLeft) + 'px';
        }
    
        // ページロード時とウィンドウリサイズ時にAnimateの初期化とレスポンシブ調整を実行
        window.addEventListener("load", initAnimate);
        window.addEventListener("resize", resizeAnimateCanvas);
    </script>
    </html>